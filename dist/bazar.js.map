{"version":3,"file":"bazar.js","sources":["../src/bazar.mjs"],"sourcesContent":["const dispatch = config => {\n  const { id } = config;\n\n  const notifs = [];\n\n  // preferring forEach over a more functional .filter followed by .map\n  // to keep O(n) time complexity when looping through a large store\n  Object.keys(_BAZAR_STORE_)\n    .forEach(currentId => {\n      if ((_BAZAR_STORE_[currentId].interests || []).indexOf(id) !== -1) {\n        notifs.push(currentId);\n      }\n    });\n\n  // execute effects\n  notifs.forEach(notif => {\n    const current = _BAZAR_STORE_[notif];\n\n    const { interests, handler } = current;\n    if (!handler) throw new Error(`Attempted trigger of undefined handler on ${notif}`);\n\n    // creating states object\n    const states = {};\n    interests\n      .forEach(interest => states[interest] = _BAZAR_STORE_[interest].sync());\n\n    // pass states to avoid reading from global\n    // avoid expose global object\n    handler(states);\n  });\n};\n\nconst register = config => {\n  const {\n    id,\n    sync,\n    handler,\n    interests,\n  } = config;\n\n  if (!id) throw new Error('Expected registrant to have non-null id value');\n  if (!sync) throw new Error('Expected registrant to have a sync function');\n  if (_BAZAR_STORE_.hasOwnProperty(id)) throw new Error('Expected unique id');\n\n  // create snapshop in global\n  _BAZAR_STORE_[id] = {\n    interests,\n    handler,\n    sync,\n  };\n};\n\nconst initState = id => (_BAZAR_STORE_.initial || {})[id];\n\nconst initStore = (states = {}) => {\n  // Evaluating the global execution context\n  const context = typeof global !== 'undefined'\n    ? global\n    : typeof self !== 'undefined'\n      ? self\n      : typeof window !== 'undefined'\n        ? window\n        : {};\n\n  context._BAZAR_STORE_ = {};\n\n  // setting up an initial store containing optional initial states\n  _BAZAR_STORE_.initial = {};\n  const initials = Object.keys(states);\n  if (initials.length > 0) initials.forEach(id => {\n    _BAZAR_STORE_.initial[id] = states[id];\n  });\n};\n\nexport {\n  initStore,\n  initState,\n  register,\n  dispatch,\n};\n"],"names":["states","global","self","window","_BAZAR_STORE_","initial","initials","Object","keys","length","forEach","id","config","Error","sync","hasOwnProperty","interests","handler","notifs","currentId","indexOf","push","notif","current","interest"],"mappings":"2BAsDmBA,kBAAS,KAEQ,oBAAXC,OACnBA,OACgB,oBAATC,KACLA,KACkB,oBAAXC,OACLA,OACA,IAEAC,cAAgB,GAGxBA,cAAcC,QAAU,OAClBC,EAAWC,OAAOC,KAAKR,GACzBM,EAASG,OAAS,GAAGH,EAASI,iBAAQC,GACxCP,cAAcC,QAAQM,GAAMX,EAAOW,iCAlBrBA,UAAOP,cAAcC,SAAW,IAAIM,8BApBrCC,qDAQVD,EAAI,MAAM,IAAIE,MAAM,qDACpBC,EAAM,MAAM,IAAID,MAAM,kDACvBT,cAAcW,eAAeJ,GAAK,MAAM,IAAIE,MAAM,sBAGtDT,cAAcO,GAAM,WAClBK,UACAC,OACAH,8BAhDaF,GACPD,WAEFO,EAAS,GAIfX,OAAOC,KAAKJ,eACTM,iBAAQS,IACyD,KAA3Df,cAAce,GAAWH,WAAa,IAAII,QAAQT,IACrDO,EAAOG,KAAKF,KAKlBD,EAAOR,iBAAQY,OACPC,EAAUnB,cAAckB,iCAGzBL,EAAS,MAAM,IAAIJ,mDAAmDS,OAGrEtB,EAAS,GACfgB,EACGN,iBAAQc,UAAYxB,EAAOwB,GAAYpB,cAAcoB,GAAUV,SAIlEG,EAAQjB"}