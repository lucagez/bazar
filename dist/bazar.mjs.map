{"version":3,"file":"bazar.mjs","sources":["../src/bazar.mjs"],"sourcesContent":["const dispatch = (config, state) => {\n  const { id, notifs, ignores = [] } = config;\n\n  const clone = typeof state === 'object'\n    ? Object.assign({}, state)\n    : state;\n\n  if (ignores.length > 0) {\n    ignores.forEach(ignore => {\n      delete clone[ignore];\n    });\n  }\n\n  // update global store\n  _store_[id] = {\n    ..._store_[id],\n    state: clone,\n  };\n\n  // execute effects\n  notifs.forEach(notif => {\n    const current = _store_[notif];\n\n    // creating states object\n    const states = {};\n    current.interests\n      .forEach(interest => states[interest] = _store_[interest].state);\n\n    // pass states to avoid reading from global\n    // avoid expose global object\n    current.handler(states);\n  });\n};\n\nconst register = (config, state) => {\n  const {\n    id,\n    notifs = [],\n    interests = [],\n    ignores = [],\n    handler = undefined,\n  } = config;\n\n  if (!id) throw new Error('Expected registrar to have non-null id value');\n  // if (_store_.hasOwnPropery(id) !== -1) throw new Error('Expected unique id');\n\n  const clone = Object.assign({}, state);\n\n  if (ignores.length > 0) {\n    ignores.forEach(ignore => {\n      delete clone[ignore];\n    });\n  }\n\n  // create snapshop in global\n  _store_[id] = {\n    notifs,\n    interests,\n    handler,\n    state: clone,\n  };\n};\n\nconst initStore = () => {\n  const context = typeof global !== 'undefined'\n    ? global\n    : typeof self !== 'undefined'\n      ? self\n      : typeof window !== 'undefined'\n        ? window\n        : {};\n\n  context._store_ = {};\n  // (context => {\n  //   context._store_ = {};\n  // }).call(this, global);\n};\n\nexport {\n  initStore,\n  register,\n  dispatch,\n};\n"],"names":["dispatch","config","state","clone","Object","assign","ignores","length","forEach","ignore","_store_","id","notifs","notif","current","states","interests","interest","handler","register","undefined","Error","initStore","global","self","window"],"mappings":"IAAMA,WAAYC,EAAQC,oDACM,QAExBC,EAAyB,iBAAVD,EACjBE,OAAOC,OAAO,GAAIH,GAClBA,EAEAI,EAAQC,OAAS,GACnBD,EAAQE,iBAAQC,UACPN,EAAMM,KAKjBC,QAAQC,GAAMP,iBACTM,QAAQC,IACXT,MAAOC,IAITS,EAAOJ,iBAAQK,OACPC,EAAUJ,QAAQG,GAGlBE,EAAS,GACfD,EAAQE,UACLR,iBAAQS,UAAYF,EAAOE,GAAYP,QAAQO,GAAUf,QAI5DY,EAAQI,QAAQH,MAIdI,WAAYlB,EAAQC,wCAGb,qCACG,mCACF,2CACAkB,IAGPT,EAAI,MAAM,IAAIU,MAAM,oDAGnBlB,EAAQC,OAAOC,OAAO,GAAIH,GAE5BI,EAAQC,OAAS,GACnBD,EAAQE,iBAAQC,UACPN,EAAMM,KAKjBC,QAAQC,GAAM,QACZC,YACAI,UACAE,EACAhB,MAAOC,IAILmB,cAC8B,oBAAXC,OACnBA,OACgB,oBAATC,KACLA,KACkB,oBAAXC,OACLA,OACA,IAEAf,QAAU"}