{"version":3,"file":"bazar.mjs","sources":["../src/bazar.mjs"],"sourcesContent":["const dispatch = config => {\n  const { notifs = [] } = config;\n\n  // execute effects\n  notifs.forEach(notif => {\n    const current = _BAZAR_STORE_[notif];\n\n    if (!current) throw new Error('Trying to notify a non-existent component');\n\n    const { interests, handler } = current;\n\n    // creating states object\n    const states = {};\n    interests\n      .forEach(interest => states[interest] = _BAZAR_STORE_[interest].sync());\n\n    // pass states to avoid reading from global\n    // avoid expose global object\n    if (handler) handler(states);\n  });\n};\n\nconst register = config => {\n  const {\n    id,\n    sync,\n    handler,\n    notifs = [],\n    interests = [],\n  } = config;\n\n  if (!id) throw new Error('Expected registrant to have non-null id value');\n  if (!sync) throw new Error('Expected registrant to have a sync function');\n  if (_BAZAR_STORE_.hasOwnProperty(id)) throw new Error('Expected unique id');\n\n  // create snapshop in global\n  _BAZAR_STORE_[id] = {\n    notifs,\n    interests,\n    handler,\n    sync,\n  };\n};\n\nconst initState = id => (_BAZAR_STORE_.initial || {})[id];\n\nconst initStore = (states = {}) => {\n  const context = typeof global !== 'undefined'\n    ? global\n    : typeof self !== 'undefined'\n      ? self\n      : typeof window !== 'undefined'\n        ? window\n        : {};\n\n  context._BAZAR_STORE_ = {};\n  _BAZAR_STORE_.initial = {};\n\n  const initials = Object.keys(states);\n  if (initials.length > 0) initials.forEach(id => {\n    _BAZAR_STORE_.initial[id] = states[id];\n  });\n};\n\nexport {\n  initStore,\n  initState,\n  register,\n  dispatch,\n};\n"],"names":["dispatch","config","notifs","forEach","notif","current","_BAZAR_STORE_","Error","states","interest","sync","handler","register","id","hasOwnProperty","interests","initState","initial","initStore","global","self","window","initials","Object","keys","length"],"mappings":"IAAMA,WAAWC,iCACE,IAGjBC,EAAOC,iBAAQC,OACPC,EAAUC,cAAcF,OAEzBC,EAAS,MAAM,IAAIE,MAAM,6DAKxBC,EAAS,eAEZL,iBAAQM,UAAYD,EAAOC,GAAYH,cAAcG,GAAUC,SAI9DC,GAASA,EAAQH,MAInBI,WAAWX,6DAKJ,wCACG,KAGTY,EAAI,MAAM,IAAIN,MAAM,qDACpBG,EAAM,MAAM,IAAIH,MAAM,kDACvBD,cAAcQ,eAAeD,GAAK,MAAM,IAAIN,MAAM,sBAGtDD,cAAcO,GAAM,QAClBX,YACAa,UACAJ,OACAD,IAIEM,WAAYH,UAAOP,cAAcW,SAAW,IAAIJ,IAEhDK,WAAaV,kBAAS,KACQ,oBAAXW,OACnBA,OACgB,oBAATC,KACLA,KACkB,oBAAXC,OACLA,OACA,IAEAf,cAAgB,GACxBA,cAAcW,QAAU,OAElBK,EAAWC,OAAOC,KAAKhB,GACzBc,EAASG,OAAS,GAAGH,EAASnB,iBAAQU,GACxCP,cAAcW,QAAQJ,GAAML,EAAOK"}